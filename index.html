<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Padel Pinto - Reserva tu pista</title>
    <script src="https://unpkg.com/mithril/mithril.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%2322c55e'/><text x='50%' y='50%' font-family='sans-serif' font-weight='900' font-style='italic' font-size='60' fill='white' text-anchor='middle' dominant-baseline='central'>P</text></svg>"
    />

    <style>
      :root {
        --padel-green: #2ecc71;
        --padel-blue: #0f172a;
        --padel-accent: #3b82f6;
      }

      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        background-color: #f8fafc;
      }

      .hero-container {
        position: relative;
        height: 380px;
        width: 100%;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #0f172a;
      }

      .hero-image {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0.6;
        filter: brightness(0.7);
      }

      .hero-content {
        position: relative;
        z-index: 10;
        text-align: center;
        color: white;
        padding: 0 20px;
      }

      ::-webkit-scrollbar {
        height: 6px;
        width: 6px;
      }

      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
      }

      .day-cell {
        aspect-ratio: 1 / 1;
        max-width: 48px;
        margin: 0 auto;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-fade-up {
        animation: fadeIn 0.6s ease-out forwards;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #e2e8f0;
        transition: 0.4s;
        border-radius: 24px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #2ecc71;
      }

      input:checked + .slider:before {
        transform: translateX(20px);
      }
    </style>
  </head>

  <body>
    <div id="app"></div>

    <script>
      // --- CONSTANTES ---
      const COURT_IMAGES = [
        "https://images.unsplash.com/photo-1554068865-24cecd4e34b8?q=80&w=2070&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1626224583764-f87db24ac4ea?q=80&w=2070&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1599423300746-b62533397364?q=80&w=2070&auto=format&fit=crop",
      ];
      const HOURS = [
        "09:00",
        "10:30",
        "12:00",
        "13:30",
        "16:30",
        "18:00",
        "19:30",
        "21:00",
      ];
      const MONTHS = [
        "Enero",
        "Febrero",
        "Marzo",
        "Abril",
        "Mayo",
        "Junio",
        "Julio",
        "Agosto",
        "Septiembre",
        "Octubre",
        "Noviembre",
        "Diciembre",
      ];

      const formatDate = (date) => {
        const d = new Date(date);
        return `${String(d.getDate()).padStart(2, "0")}/${String(d.getMonth() + 1).padStart(2, "0")}/${d.getFullYear()}`;
      };

      const generateInviteCode = () =>
        Math.random().toString(36).substring(2, 8).toUpperCase();

      // --- ESTADO ---
      const State = {
        isLogged: false,
        showUserMenu: false, //controla si el menú es visible por defecto
        currentView: "public",
        selectedDate: formatDate(new Date()),
        selectedTime: "10:30",
        viewMonth: new Date().getMonth(),
        viewYear: new Date().getFullYear(),
        user: {
          name: "Carlos P.",
          id: "user_123",
          foto: "https://api.dicebear.com/7.x/initials/svg?seed=CP&backgroundColor=2ecc71&textColor=0f172a", //foto con las iniciales (CP)
        },
        inviteInput: "",
        data: {
          [formatDate(new Date())]: [
            {
              courtId: 2,
              time: "10:30",
              type: "public",
              players: ["Dani L.", "Marta G."],
              positions: [0, 2],
              inviteCode: null,
              creator: "Dani L.",
            },
            {
              courtId: 1,
              time: "18:00",
              type: "private",
              players: ["Carlos P."],
              positions: [1],
              inviteCode: "XP99",
              creator: "Carlos P.",
            },
          ],
        },
        courts: [
          {
            id: 1,
            name: "Pista Central World Padel Tour",
            type: "Panorámica",
            price: "18€",
            img: COURT_IMAGES[0],
          },
          {
            id: 2,
            name: "Pista Premium Cristal 1",
            type: "Cristal",
            price: "14€",
            img: COURT_IMAGES[1],
          },
          {
            id: 3,
            name: "Pista 3 - Muro Clásica",
            type: "Muro",
            price: "10€",
            img: COURT_IMAGES[2],
          },
          {
            id: 4,
            name: "Pista 4 - Panorámica Azul",
            type: "Panorámica",
            price: "15€",
            img: COURT_IMAGES[0],
          },
          {
            id: 5,
            name: "Pista 5 - Cristal Outdoor",
            type: "Cristal",
            price: "12€",
            img: COURT_IMAGES[1],
          },
          {
            id: 6,
            name: "Pista 6 - Individual",
            type: "Individual",
            price: "9€",
            img: COURT_IMAGES[2],
          },
        ],
        modal: {
          show: false,
          courtId: null,
          time: "",
          isPrivate: false,
          selectedPos: null,
          occupiedPositions: [],
          date: "",
          inviteCode: null,
        },
        confirmModal: { show: false, date: "", matchIndex: -1 },
        toast: { show: false, message: "" },
        heroImage:
          "https://images.unsplash.com/photo-1626224583764-f87db24ac4ea?q=80&w=2070&auto=format&fit=crop",
      };

      // --- ACCIONES ---
      const Actions = {
        changeMonth: (dir) => {
          State.viewMonth += dir;
          if (State.viewMonth < 0) {
            State.viewMonth = 11;
            State.viewYear--;
          } else if (State.viewMonth > 11) {
            State.viewMonth = 0;
            State.viewYear++;
          }
          m.redraw();
        },
        login: () => {
          State.isLogged = true;
          State.currentView = "booking";
          Actions.showToast("Bienvenido de nuevo");
        },
        logout: () => {
          //iniciamos el efecto de carga
          State.isTerminatingSession = true;
          State.showUserMenu = false;
          m.redraw();

          //esperamos un momento (1,2 seg)
          setTimeout(() => {
            State.isLogged = false;
            State.isTerminatingSession = false; //quitamos el efecto
            State.currentView = "public";

            //limpiamos la URL por si acaso
            window.history.replaceState(
              {},
              document.title,
              window.location.pathname,
            );

            Actions.showToast("Has salido de tu sesión");
            m.redraw();
          }, 1200);
        },
        checkSession: () => {
          const params = new URLSearchParams(window.location.search);
          if (params.get("auth") === "success") {
            State.isLogged = true;
            State.currentView = "booking";
            //limpiamos la URL para que no diga "?auth=success" todo el tiempo
            window.history.replaceState(
              {},
              document.title,
              window.location.pathname,
            );
            Actions.showToast("¡Sesión iniciada correctamente!");
          }
        },
        toggleUserMenu: (e) => {
          e.stopPropagation(); //evita que el click se propague
          State.showUserMenu = !State.showUserMenu;
        },
        showToast: (msg) => {
          State.toast.message = msg;
          State.toast.show = true;
          m.redraw();
          setTimeout(() => {
            State.toast.show = false;
            m.redraw();
          }, 3000);
        },
        openBooking: (courtId, time, date = State.selectedDate) => {
          if (!State.isLogged)
            return Actions.showToast("Inicia sesión para reservar");
          const match = (State.data[date] || []).find(
            (m) => m.courtId === courtId && m.time === time,
          );

          State.modal = {
            show: true,
            courtId,
            time,
            date,
            isPrivate: match ? match.type === "private" : false,
            selectedPos: null,
            occupiedPositions: match ? match.positions : [],
            isJoining: !!match,
            generatedCode: match ? match.inviteCode : generateInviteCode(),
          };
        },
        confirmMatch: () => {
          if (State.modal.selectedPos === null) return;
          if (!State.data[State.modal.date]) State.data[State.modal.date] = [];
          const dayMatches = State.data[State.modal.date];
          const existing = dayMatches.find(
            (m) =>
              m.courtId === State.modal.courtId && m.time === State.modal.time,
          );

          if (existing) {
            existing.players.push("Carlos P.");
            existing.positions.push(State.modal.selectedPos);
          } else {
            dayMatches.push({
              courtId: State.modal.courtId,
              time: State.modal.time,
              type: State.modal.isPrivate ? "private" : "public",
              inviteCode: State.modal.isPrivate
                ? State.modal.generatedCode
                : null,
              players: ["Carlos P."],
              positions: [State.modal.selectedPos],
              creator: "Carlos P.",
            });
          }
          State.modal.show = false;
          Actions.showToast(
            `¡Reserva confirmada! ${State.modal.isPrivate ? "Código: " + State.modal.generatedCode : "Partida Abierta"}`,
          );
        },
        joinByCode: () => {
          if (!State.inviteInput) return;
          let found = null;
          Object.keys(State.data).forEach((date) => {
            const match = (State.data[date] || []).find(
              (m) => m.inviteCode === State.inviteInput.toUpperCase(),
            );
            if (match) found = { ...match, date };
          });

          if (found) {
            if (found.players.length >= 4)
              return Actions.showToast("La partida ya está completa");
            if (found.players.includes("Carlos P."))
              return Actions.showToast("Ya estás en esta partida");
            Actions.openBooking(found.courtId, found.time, found.date);
            State.inviteInput = "";
          } else {
            Actions.showToast("Código no válido");
          }
        },
        cancelBooking: (date, matchIndex) => {
          const match = State.data[date][matchIndex];
          const playerIndex = match.players.indexOf("Carlos P.");

          if (playerIndex > -1) {
            match.players.splice(playerIndex, 1);
            match.positions.splice(playerIndex, 1);

            //si no quedan jugadores, eliminar la partida
            if (match.players.length === 0) {
              State.data[date].splice(matchIndex, 1);
            }

            Actions.showToast("Reserva cancelada correctamente");
          }
          State.confirmModal.show = false;
        },
        scrollToBooking: () => {
          document
            .getElementById("booking-section")
            ?.scrollIntoView({ behavior: "smooth" });
        },
      };

      // --- COMPONENTES ---

      const Navbar = {
        view: () =>
          m(
            "nav",
            {
              class:
                "bg-white/80 backdrop-blur-md border-b sticky top-0 z-50 px-4",
            },
            [
              m(
                "div",
                {
                  class:
                    "max-w-6xl mx-auto flex justify-between items-center h-16",
                },
                [
                  m(
                    "div",
                    {
                      class: "flex items-center gap-2 cursor-pointer",
                      onclick: () =>
                        (State.currentView = State.isLogged
                          ? "booking"
                          : "public"),
                    },
                    [
                      m(
                        "div",
                        {
                          class:
                            "w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center text-white font-black italic shadow-lg shadow-green-200",
                        },
                        "P",
                      ),
                      m(
                        "span",
                        {
                          class:
                            "font-black text-lg tracking-tighter text-slate-800",
                        },
                        "PADELPINTO",
                      ),
                    ],
                  ),
                  m("div", { class: "flex items-center gap-6" }, [
                    State.isLogged
                      ? [
                          m(
                            "button",
                            {
                              class: `text-[10px] font-black tracking-widest ${State.currentView === "booking" ? "text-green-500 border-b-2 border-green-500" : "text-slate-400"} pb-1 transition-all`,
                              onclick: () => (State.currentView = "booking"),
                            },
                            "RESERVAR",
                          ),
                          m(
                            "button",
                            {
                              class: `text-[10px] font-black tracking-widest ${State.currentView === "matchmaking" ? "text-green-500 border-b-2 border-green-500" : "text-slate-400"} pb-1 transition-all`,
                              onclick: () =>
                                (State.currentView = "matchmaking"),
                            },
                            "PARTIDAS ABIERTAS",
                          ),
                          m(
                            "button",
                            {
                              class: `text-[10px] font-black tracking-widest ${State.currentView === "agenda" ? "text-green-500 border-b-2 border-green-500" : "text-slate-400"} pb-1 transition-all`,
                              onclick: () => (State.currentView = "agenda"),
                            },
                            "MI AGENDA",
                          ),
                          m("div", { class: "relative" }, [
                            //circulo del perfil
                            m(
                              "div",
                              {
                                class:
                                  "w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-[10px] font-bold border-2 border-green-500 cursor-pointer hover:scale-105 transition-transform",
                                onclick: Actions.toggleUserMenu,
                              },
                              "CP",
                            ),

                            //menu desplegable
                            State.showUserMenu &&
                              m(
                                "div",
                                {
                                  class:
                                    "absolute right-0 mt-2 w-48 bg-white rounded-2xl shadow-xl border border-slate-100 py-2 z-[100] animate-fade-up",
                                  style: "transform-origin: top right;",
                                },
                                [
                                  m(
                                    "div",
                                    {
                                      class:
                                        "px-4 py-2 border-b border-slate-50 mb-1",
                                    },
                                    [
                                      m(
                                        "p",
                                        {
                                          class:
                                            "text-[10px] font-black text-slate-400 uppercase",
                                        },
                                        "Usuario",
                                      ),
                                      m(
                                        "p",
                                        {
                                          class:
                                            "text-xs font-bold text-slate-800",
                                        },
                                        "Carlos P.",
                                      ),
                                    ],
                                  ),
                                  m(
                                    "button",
                                    {
                                      class:
                                        "w-full text-left px-4 py-2 text-xs font-bold text-slate-600 hover:bg-slate-50 hover:text-green-500 transition",
                                      onclick: () => {
                                        window.location.href = "perfil.html";
                                        State.showUserMenu = false; // Opcional: cerramos el menú antes de salir aunque la página se recargue
                                      },
                                    },
                                    "Mi Perfil",
                                  ),
                                  m(
                                    "button",
                                    {
                                      class:
                                        "w-full text-left px-4 py-2 text-xs font-bold text-slate-600 hover:bg-slate-50 hover:text-green-500 transition",
                                      onclick: () => {
                                        /* Otra opción */ State.showUserMenu = false;
                                      },
                                    },
                                    "Configuración",
                                  ),
                                  m("hr", { class: "my-1 border-slate-50" }),
                                  m(
                                    "button",
                                    {
                                      class:
                                        "w-full text-left px-4 py-2 text-xs font-bold text-red-500 hover:bg-red-50 transition",
                                      onclick: Actions.logout,
                                    },
                                    "Cerrar sesión",
                                  ),
                                ],
                              ),
                          ]),
                        ]
                      : m("div", [
                          State.isLogged
                            ? // --- VISTA LOGUEADO (Con el menú desplegable que hicimos antes) ---
                              m("div", { class: "relative" }, [
                                m(
                                  "div",
                                  {
                                    class:
                                      "w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-[10px] font-bold border-2 border-green-500 cursor-pointer hover:scale-105 transition-transform",
                                    onclick: Actions.toggleUserMenu,
                                  },
                                  "CP",
                                ),
                                // ... (aquí iría el código del menú State.showUserMenu && m("div", ...))
                              ])
                            : // --- VISTA NO LOGUEADO (Dos botones) ---
                              m("div", { class: "flex items-center gap-3" }, [
                                // Botón de Login
                                m(
                                  "button",
                                  {
                                    class:
                                      "text-slate-600 hover:text-slate-900 px-4 py-2 text-xs font-bold transition",
                                    onclick: () =>
                                      (window.location.href = "login.html"),
                                  },
                                  "Entrar",
                                ),

                                // Botón de Registro
                                m(
                                  "button",
                                  {
                                    class:
                                      "bg-green-500 hover:bg-green-400 text-slate-900 px-5 py-2 rounded-full text-xs font-black shadow-lg shadow-green-100 transition transform active:scale-95",
                                    onclick: () =>
                                      (window.location.href = "registro.html"),
                                  },
                                  "Crear cuenta",
                                ),
                              ]),
                        ]),
                  ]),
                ],
              ),
            ],
          ),
      };

      const Hero = {
        view: () => {
          const showButtons =
            State.currentView === "public" || State.currentView === "booking";
          return m("header", { class: "hero-container" }, [
            m("img", {
              src: State.heroImage,
              class: "hero-image animate-fade-up",
            }),
            m("div", { class: "hero-content animate-fade-up" }, [
              m(
                "span",
                {
                  class:
                    "inline-block px-3 py-1 bg-green-500 text-slate-900 text-[10px] font-black rounded-full mb-4",
                },
                "COMUNIDAD PADEL PRO",
              ),
              m(
                "h1",
                {
                  class: "text-4xl md:text-6xl font-black mb-4 tracking-tight",
                },
                "Juguemos Al Pádel",
              ),
              m(
                "p",
                {
                  class:
                    "text-slate-200 text-sm md:text-lg max-w-xl mx-auto font-medium mb-8",
                },
                "Reserva las mejores pistas panorámicas en segundos o únete a partidas abiertas.",
              ),

              showButtons &&
                m(
                  "div",
                  { class: "flex flex-col sm:flex-row justify-center gap-4" },
                  [
                    State.isLogged
                      ? m(
                          "button",
                          {
                            class:
                              "bg-green-500 hover:bg-green-400 px-8 py-4 rounded-2xl font-black text-slate-900 transition shadow-xl transform hover:scale-105",
                            onclick: Actions.scrollToBooking,
                          },
                          "VER MIS RESERVAS",
                        )
                      : m(
                          "button",
                          {
                            class:
                              "bg-green-500 hover:bg-green-400 px-8 py-4 rounded-2xl font-black text-slate-900 transition shadow-xl transform hover:scale-105",
                            onclick: Actions.login,
                          },
                          "EMPEZAR AHORA",
                        ),
                    m(
                      "button",
                      {
                        class:
                          "bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 px-8 py-4 rounded-2xl font-black transition",
                        onclick: Actions.scrollToBooking,
                      },
                      "VER PISTAS",
                    ),
                  ],
                ),
            ]),
          ]);
        },
      };

      const Calendar = {
        view: () => {
          const firstDay = new Date(
            State.viewYear,
            State.viewMonth,
            1,
          ).getDay();
          const daysInMonth = new Date(
            State.viewYear,
            State.viewMonth + 1,
            0,
          ).getDate();
          const blanks = Array(firstDay === 0 ? 6 : firstDay - 1).fill(null);
          const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);

          return m(
            "div",
            {
              class:
                "bg-white p-5 rounded-[32px] border border-slate-100 shadow-sm mb-6",
            },
            [
              m("div", { class: "flex justify-between items-center mb-5" }, [
                m("div", [
                  m(
                    "p",
                    {
                      class:
                        "text-[9px] font-black text-green-500 uppercase tracking-widest mb-0.5",
                    },
                    "Calendario",
                  ),
                  m(
                    "h3",
                    { class: "text-base font-black text-slate-800" },
                    `${MONTHS[State.viewMonth]} ${State.viewYear}`,
                  ),
                ]),
                m("div", { class: "flex gap-1" }, [
                  m(
                    "button",
                    {
                      class:
                        "w-8 h-8 flex items-center justify-center hover:bg-slate-50 rounded-xl transition",
                      onclick: () => Actions.changeMonth(-1),
                    },
                    "‹",
                  ),
                  m(
                    "button",
                    {
                      class:
                        "w-8 h-8 flex items-center justify-center hover:bg-slate-50 rounded-xl transition",
                      onclick: () => Actions.changeMonth(1),
                    },
                    "›",
                  ),
                ]),
              ]),
              m(
                "div",
                {
                  class:
                    "calendar-grid text-[10px] font-bold text-slate-300 mb-2 text-center",
                },
                ["L", "M", "X", "J", "V", "S", "D"].map((d) => m("div", d)),
              ),
              m("div", { class: "calendar-grid" }, [
                ...blanks.map(() => m("div")),
                ...days.map((d) => {
                  const dateStr = formatDate(
                    new Date(State.viewYear, State.viewMonth, d),
                  );
                  const isSelected = State.selectedDate === dateStr;
                  const hasData =
                    State.data[dateStr] && State.data[dateStr].length > 0;
                  return m(
                    "button",
                    {
                      class: `day-cell w-full rounded-2xl flex items-center justify-center text-xs font-bold transition-all relative ${isSelected ? "bg-green-500 text-slate-900 shadow-lg shadow-green-100 scale-105 z-10" : "hover:bg-slate-50 text-slate-600"}`,
                      onclick: () => (State.selectedDate = dateStr),
                    },
                    [
                      m("span", d),
                      hasData &&
                        m("div", {
                          class: `w-1.5 h-1.5 rounded-full absolute bottom-2 ${isSelected ? "bg-slate-900" : "bg-green-500"}`,
                        }),
                    ],
                  );
                }),
              ]),
            ],
          );
        },
      };

      const CourtGrid = {
        view: () =>
          m(
            "div",
            { class: "grid grid-cols-1 sm:grid-cols-2 gap-4" },
            State.courts.map((c) => {
              const match = (State.data[State.selectedDate] || []).find(
                (m) => m.courtId === c.id && m.time === State.selectedTime,
              );
              const isFull = match?.players.length >= 4;
              const userIn = match?.players.includes("Carlos P.");
              const label = isFull
                ? "CERRADO"
                : match?.type === "private"
                  ? "PRIVADO"
                  : "ABIERTO";

              return m(
                "div",
                {
                  class:
                    "bg-white rounded-3xl border border-slate-100 overflow-hidden flex shadow-sm hover:shadow-md transition-all group",
                },
                [
                  m("div", {
                    class: "w-32 bg-cover bg-center",
                    style: `background-image: url(${c.img})`,
                  }),
                  m("div", { class: "p-4 flex-1" }, [
                    m(
                      "h4",
                      {
                        class:
                          "font-black text-slate-800 text-xs mb-1 truncate",
                      },
                      c.name,
                    ),
                    m(
                      "div",
                      { class: "flex justify-between items-center mb-3" },
                      [
                        m(
                          "span",
                          {
                            class:
                              "text-[9px] text-slate-400 font-bold uppercase",
                          },
                          c.type,
                        ),
                        m(
                          "span",
                          { class: "text-[10px] font-black text-green-600" },
                          c.price,
                        ),
                      ],
                    ),
                    match &&
                      m("div", { class: "mb-3" }, [
                        m(
                          "div",
                          {
                            class:
                              "flex justify-between text-[8px] font-black mb-1",
                          },
                          [
                            m(
                              "span",
                              {
                                class: isFull
                                  ? "text-slate-400"
                                  : match.type === "private"
                                    ? "text-red-400"
                                    : "text-amber-500",
                              },
                              label,
                            ),
                            m(
                              "span",
                              { class: "text-slate-400" },
                              `${match.players.length}/4`,
                            ),
                          ],
                        ),
                        m(
                          "div",
                          {
                            class:
                              "w-full bg-slate-50 h-1 rounded-full overflow-hidden",
                          },
                          m("div", {
                            class: isFull ? "bg-slate-300" : "bg-green-500",
                            style: `width: ${(match.players.length / 4) * 100}%`,
                          }),
                        ),
                      ]),
                    m(
                      "button",
                      {
                        class: `w-full py-2.5 rounded-xl text-[10px] font-black transition ${userIn ? "bg-slate-100 text-slate-400" : isFull ? "bg-slate-50 text-slate-300" : match ? "bg-slate-900 text-white shadow-lg" : "bg-green-500 text-slate-900"}`,
                        onclick: () =>
                          !userIn &&
                          !isFull &&
                          Actions.openBooking(c.id, State.selectedTime),
                      },
                      userIn
                        ? "INSCRITO"
                        : isFull
                          ? "LLENO"
                          : match
                            ? "UNIRSE"
                            : "RESERVAR",
                    ),
                  ]),
                ],
              );
            }),
          ),
      };

      const MatchmakingView = {
        view: () => {
          const openMatches = [];
          Object.keys(State.data).forEach((date) => {
            State.data[date].forEach((m) => {
              if (m.type === "public") openMatches.push({ ...m, date });
            });
          });

          return m("div", { class: "flex-1 animate-fade-up" }, [
            m(
              "h2",
              { class: "text-2xl font-black text-slate-800 mb-6" },
              "Partidas Abiertas",
            ),
            openMatches.length === 0
              ? m(
                  "div",
                  { class: "py-20 text-center bg-white rounded-3xl" },
                  "No hay partidas buscando jugadores.",
                )
              : m(
                  "div",
                  { class: "grid gap-4" },
                  openMatches.map((match) => {
                    const court = State.courts.find(
                      (c) => c.id === match.courtId,
                    );
                    const isFull = match.players.length >= 4;
                    return m(
                      "div",
                      {
                        class:
                          "bg-white p-5 rounded-3xl shadow-sm flex items-center justify-between border border-slate-50",
                      },
                      [
                        m("div", { class: "flex gap-4 items-center" }, [
                          m(
                            "div",
                            {
                              class:
                                "w-12 h-12 rounded-2xl bg-slate-50 flex flex-col items-center justify-center font-black",
                            },
                            [
                              m(
                                "span",
                                { class: "text-[10px] text-slate-400" },
                                match.date.split("/")[1],
                              ),
                              m(
                                "span",
                                { class: "text-sm" },
                                match.date.split("/")[0],
                              ),
                            ],
                          ),
                          m("div", [
                            m(
                              "p",
                              { class: "text-xs font-black" },
                              `${match.time}H - ${court.name}`,
                            ),
                            m(
                              "p",
                              { class: "text-[10px] font-bold text-slate-400" },
                              isFull
                                ? "PARTIDA CERRADA"
                                : `${match.players.length}/4 jugadores inscritos`,
                            ),
                          ]),
                        ]),
                        m(
                          "button",
                          {
                            class: `px-6 py-2 rounded-xl text-[10px] font-black shadow-lg ${isFull ? "bg-slate-100 text-slate-400" : "bg-green-500 text-slate-900 shadow-green-100"}`,
                            disabled: isFull,
                            onclick: () =>
                              Actions.openBooking(
                                match.courtId,
                                match.time,
                                match.date,
                              ),
                          },
                          isFull ? "CERRADO" : "UNIRSE",
                        ),
                      ],
                    );
                  }),
                ),
          ]);
        },
      };

      const AgendaView = {
        view: () => {
          const myMatches = [];
          Object.keys(State.data).forEach((date) => {
            State.data[date].forEach((m, idx) => {
              if (m.players.includes("Carlos P."))
                myMatches.push({ ...m, date, originalIndex: idx });
            });
          });

          return m("div", { class: "flex-1 animate-fade-up" }, [
            m(
              "h2",
              { class: "text-2xl font-black text-slate-800 mb-6" },
              "Mi Agenda",
            ),
            myMatches.length === 0
              ? m(
                  "div",
                  { class: "py-20 text-center bg-white rounded-3xl" },
                  "No tienes reservas próximamente.",
                )
              : m(
                  "div",
                  { class: "grid gap-4" },
                  myMatches.map((match) => {
                    const court = State.courts.find(
                      (c) => c.id === match.courtId,
                    );
                    return m(
                      "div",
                      {
                        class:
                          "bg-white p-5 rounded-3xl shadow-sm border-l-4 border-green-500 flex justify-between items-center hover:shadow-md transition",
                      },
                      [
                        m("div", [
                          m("div", { class: "flex items-center gap-2 mb-1" }, [
                            m(
                              "p",
                              { class: "text-xs font-black text-slate-900" },
                              `${match.date} - ${match.time}H`,
                            ),
                            match.inviteCode &&
                              m(
                                "span",
                                {
                                  class:
                                    "text-[8px] bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 font-black tracking-widest",
                                },
                                `ID: ${match.inviteCode}`,
                              ),
                          ]),
                          m(
                            "p",
                            {
                              class:
                                "text-[10px] font-bold text-slate-400 uppercase",
                            },
                            court.name,
                          ),
                        ]),
                        m(
                          "button",
                          {
                            class:
                              "bg-red-50 text-red-500 hover:bg-red-500 hover:text-white px-4 py-2 rounded-xl text-[10px] font-black transition-all",
                            onclick: () => {
                              State.confirmModal = {
                                show: true,
                                date: match.date,
                                matchIndex: match.originalIndex,
                              };
                            },
                          },
                          "CANCELAR",
                        ),
                      ],
                    );
                  }),
                ),
          ]);
        },
      };

      const BookingModal = {
        view: () =>
          State.modal.show &&
          m(
            "div",
            {
              class:
                "fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",
            },
            [
              m(
                "div",
                {
                  class:
                    "bg-white w-full max-w-sm rounded-[40px] overflow-hidden shadow-2xl animate-fade-up",
                },
                [
                  m("div", { class: "bg-slate-900 p-8 text-white" }, [
                    m("div", { class: "flex justify-between items-start" }, [
                      m("div", [
                        m(
                          "h3",
                          { class: "text-xl font-black tracking-tight" },
                          State.modal.isJoining
                            ? "Únete a la Partida"
                            : "Configura tu Reserva",
                        ),
                        m(
                          "p",
                          {
                            class:
                              "text-[10px] text-slate-400 font-bold uppercase mt-1",
                          },
                          `${State.modal.date} @ ${State.modal.time}H`,
                        ),
                      ]),
                      m(
                        "button",
                        {
                          class: "text-slate-400 hover:text-white transition",
                          onclick: () => (State.modal.show = false),
                        },
                        "✕",
                      ),
                    ]),
                  ]),
                  m("div", { class: "p-8 text-center" }, [
                    !State.modal.isJoining &&
                      m(
                        "div",
                        {
                          class:
                            "flex items-center justify-between mb-6 p-4 bg-slate-50 rounded-2xl border border-slate-100",
                        },
                        [
                          m("div", { class: "text-left" }, [
                            m(
                              "p",
                              { class: "text-xs font-black text-slate-800" },
                              "Partida Privada",
                            ),
                            m(
                              "p",
                              { class: "text-[9px] text-slate-400 font-bold" },
                              "Solo con código de invitación",
                            ),
                          ]),
                          m("label", { class: "toggle-switch" }, [
                            m("input", {
                              type: "checkbox",
                              checked: State.modal.isPrivate,
                              onchange: (e) =>
                                (State.modal.isPrivate = e.target.checked),
                            }),
                            m("span", { class: "slider" }),
                          ]),
                        ],
                      ),

                    State.modal.isPrivate &&
                      m(
                        "div",
                        {
                          class:
                            "mb-6 p-3 bg-green-50 rounded-2xl border border-dashed border-green-200",
                        },
                        [
                          m(
                            "p",
                            {
                              class:
                                "text-[9px] font-black text-green-600 uppercase mb-1",
                            },
                            "Código de Invitación",
                          ),
                          m(
                            "p",
                            {
                              class:
                                "text-lg font-black tracking-widest text-slate-800",
                            },
                            State.modal.generatedCode,
                          ),
                        ],
                      ),

                    m(
                      "p",
                      {
                        class:
                          "text-[10px] font-black text-slate-400 uppercase mb-4",
                      },
                      "Elige tu posición",
                    ),
                    m(
                      "div",
                      {
                        class:
                          "relative w-full aspect-[2/3] max-w-[160px] mx-auto bg-green-600 rounded-xl border-2 border-white/40 shadow-xl mb-8",
                      },
                      [
                        m("div", {
                          class: "absolute inset-x-0 top-1/2 h-0.5 bg-white/20",
                        }),
                        m("div", {
                          class:
                            "absolute inset-y-0 left-1/2 w-0.5 bg-white/20",
                        }),
                        [
                          { id: 0, l: "Izq", t: "15%", lf: "12%" },
                          { id: 1, l: "Izq", t: "70%", lf: "12%" },
                          { id: 2, l: "Der", t: "15%", lf: "53%" },
                          { id: 3, l: "Der", t: "70%", lf: "53%" },
                        ].map((p) => {
                          const occ = State.modal.occupiedPositions.includes(
                            p.id,
                          );
                          const sel = State.modal.selectedPos === p.id;
                          return m(
                            "button",
                            {
                              class: `absolute w-[35%] h-[15%] rounded-xl text-[9px] font-black transition-all ${occ ? "bg-slate-800 text-white/10" : sel ? "bg-white text-green-600 scale-110 shadow-lg" : "bg-white/90 text-slate-800 hover:bg-white"}`,
                              style: `top: ${p.t}; left: ${p.lf}`,
                              disabled: occ,
                              onclick: () => (State.modal.selectedPos = p.id),
                            },
                            occ ? "X" : p.l,
                          );
                        }),
                      ],
                    ),
                    m(
                      "button",
                      {
                        class: `w-full py-4 rounded-2xl text-xs font-black transition-all ${State.modal.selectedPos === null ? "bg-slate-100 text-slate-300" : "bg-green-500 text-slate-900 shadow-xl shadow-green-100"}`,
                        disabled: State.modal.selectedPos === null,
                        onclick: Actions.confirmMatch,
                      },
                      "CONFIRMAR RESERVA",
                    ),
                  ]),
                ],
              ),
            ],
          ),
      };

      const ConfirmModal = {
        view: () =>
          State.confirmModal.show &&
          m(
            "div",
            {
              class:
                "fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[150] flex items-center justify-center p-4",
            },
            [
              m(
                "div",
                {
                  class:
                    "bg-white w-full max-w-xs rounded-[32px] p-6 text-center animate-fade-up shadow-2xl",
                },
                [
                  m(
                    "div",
                    {
                      class:
                        "w-12 h-12 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4",
                    },
                    "!",
                  ),
                  m(
                    "h3",
                    { class: "text-lg font-black text-slate-800 mb-2" },
                    "¿Cancelar reserva?",
                  ),
                  m(
                    "p",
                    { class: "text-xs text-slate-400 font-medium mb-6" },
                    "Esta acción eliminará tu plaza en la pista. ¿Estás seguro?",
                  ),
                  m("div", { class: "flex gap-3" }, [
                    m(
                      "button",
                      {
                        class:
                          "flex-1 py-3 rounded-xl bg-slate-100 text-slate-600 text-xs font-black hover:bg-slate-200 transition",
                        onclick: () => (State.confirmModal.show = false),
                      },
                      "VOLVER",
                    ),
                    m(
                      "button",
                      {
                        class:
                          "flex-1 py-3 rounded-xl bg-red-500 text-white text-xs font-black hover:bg-red-600 transition shadow-lg shadow-red-100",
                        onclick: () =>
                          Actions.cancelBooking(
                            State.confirmModal.date,
                            State.confirmModal.matchIndex,
                          ),
                      },
                      "SÍ, CANCELAR",
                    ),
                  ]),
                ],
              ),
            ],
          ),
      };

      const Footer = {
        view: () =>
          m(
            "footer",
            { class: "bg-slate-900 text-white mt-20 pt-16 pb-8 px-4" },
            [
              m("div", { class: "max-w-6xl mx-auto" }, [
                m(
                  "div",
                  { class: "grid grid-cols-1 md:grid-cols-3 gap-12 mb-12" },
                  [
                    // Columna 1: Branding
                    m("div", [
                      m("div", { class: "flex items-center gap-2 mb-6" }, [
                        m(
                          "div",
                          {
                            class:
                              "w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center text-white font-black italic text-sm",
                          },
                          "P",
                        ),
                        m(
                          "span",
                          { class: "font-extrabold text-xl tracking-tighter" },
                          "PADELPINTO ",
                        ),
                      ]),
                      m(
                        "p",
                        { class: "text-slate-400 text-sm leading-relaxed" },
                        "La plataforma líder para la gestión de pistas y comunidades de pádel. Reserva, juega y conecta con otros jugadores en un solo lugar.",
                      ),
                    ]),
                    // Columna 2: Enlaces rápidos
                    m("div", [
                      m(
                        "h4",
                        {
                          class:
                            "font-bold mb-6 text-green-500 uppercase text-xs tracking-widest",
                        },
                        "Navegación",
                      ),
                      m("ul", { class: "space-y-4 text-sm text-slate-300" }, [
                        m(
                          "li",
                          {
                            class: "hover:text-white cursor-pointer transition",
                          },
                          "Centro de Ayuda",
                        ),
                        m(
                          "li",
                          {
                            class: "hover:text-white cursor-pointer transition",
                          },
                          "Normas del Club",
                        ),
                        m(
                          "li",
                          {
                            class: "hover:text-white cursor-pointer transition",
                          },
                          "Ranking Local",
                        ),
                        m(
                          "li",
                          {
                            class: "hover:text-white cursor-pointer transition",
                          },
                          "Torneos",
                        ),
                      ]),
                    ]),
                    // Columna 3: Newsletter/Social
                    m("div", [
                      m(
                        "h4",
                        {
                          class:
                            "font-bold mb-6 text-green-500 uppercase text-xs tracking-widest",
                        },
                        "Mantente al día",
                      ),
                      m("div", { class: "flex gap-2 mb-4" }, [
                        m("input[type=text]", {
                          class:
                            "bg-slate-800 border-none rounded-lg px-4 py-2 text-sm w-full focus:ring-2 focus:ring-green-500",
                          placeholder: "Tu email",
                        }),
                        m(
                          "button",
                          {
                            class:
                              "bg-green-500 text-slate-900 px-4 py-2 rounded-lg font-bold text-sm",
                          },
                          "OK",
                        ),
                      ]),
                      m("div", { class: "flex gap-4 text-slate-400" }, [
                        m(
                          "span",
                          { class: "hover:text-white cursor-pointer" },
                          "Instagram",
                        ),
                        m(
                          "span",
                          { class: "hover:text-white cursor-pointer" },
                          "Twitter",
                        ),
                        m(
                          "span",
                          { class: "hover:text-white cursor-pointer" },
                          "Facebook",
                        ),
                      ]),
                    ]),
                  ],
                ),
                m(
                  "div",
                  {
                    class:
                      "border-t border-slate-800 pt-8 flex flex-col md:row justify-between items-center gap-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest",
                  },
                  [
                    m(
                      "span",
                      "© 2026 Padel Pro International. Todos los derechos reservados.",
                    ),
                    m("div", { class: "flex gap-6" }, [
                      m(
                        "span",
                        { class: "hover:text-slate-300 cursor-pointer" },
                        "Privacidad",
                      ),
                      m(
                        "span",
                        { class: "hover:text-slate-300 cursor-pointer" },
                        "Términos",
                      ),
                      m(
                        "span",
                        { class: "hover:text-slate-300 cursor-pointer" },
                        "Cookies",
                      ),
                    ]),
                  ],
                ),
              ]),
            ],
          ),
      };

      const MainLayout = {
        view: () =>
          m("div", [
            m(Navbar),
            m(Hero),
            m(
              "main",
              {
                id: "booking-section",
                class:
                  "max-w-6xl mx-auto p-4 py-12 flex flex-col md:flex-row gap-8",
              },
              [
                (State.currentView === "public" ||
                  State.currentView === "booking") &&
                  m("aside", { class: "w-full md:w-80 flex-shrink-0" }, [
                    m(Calendar),

                    State.isLogged &&
                      m(
                        "div",
                        {
                          class:
                            "bg-slate-900 p-6 rounded-[32px] mb-6 shadow-xl",
                        },
                        [
                          m(
                            "p",
                            {
                              class:
                                "text-[9px] font-black text-green-500 uppercase tracking-widest mb-3",
                            },
                            "Unirse con Código",
                          ),
                          m("div", { class: "flex gap-2" }, [
                            m("input", {
                              class:
                                "flex-1 bg-white/10 border border-white/10 rounded-xl px-4 py-2 text-white text-xs font-bold focus:outline-none focus:border-green-500 uppercase",
                              placeholder: "CÓDIGO",
                              value: State.inviteInput,
                              oninput: (e) =>
                                (State.inviteInput = e.target.value),
                            }),
                            m(
                              "button",
                              {
                                class:
                                  "bg-green-500 p-2 rounded-xl text-slate-900",
                                onclick: Actions.joinByCode,
                              },
                              "→",
                            ),
                          ]),
                        ],
                      ),

                    m(
                      "p",
                      {
                        class:
                          "text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4 pl-1",
                      },
                      "Seleccionar Hora",
                    ),
                    m(
                      "div",
                      { class: "grid grid-cols-4 gap-2" },
                      HOURS.map((h) =>
                        m(
                          "button",
                          {
                            class: `py-3 rounded-2xl text-[10px] font-bold border transition-all ${State.selectedTime === h ? "bg-slate-900 text-white border-slate-900 shadow-xl" : "bg-white text-slate-500 border-slate-100 hover:border-green-200"}`,
                            onclick: () => (State.selectedTime = h),
                          },
                          h,
                        ),
                      ),
                    ),
                  ]),

                State.currentView === "public" ||
                State.currentView === "booking"
                  ? m("section", { class: "flex-1" }, [
                      m(
                        "div",
                        { class: "flex items-center justify-between mb-8" },
                        [
                          m("div", { class: "flex items-center gap-4" }, [
                            m("div", {
                              class: "w-1 h-8 bg-green-500 rounded-full",
                            }),
                            m("div", [
                              m(
                                "h2",
                                {
                                  class:
                                    "text-2xl font-black text-slate-800 tracking-tight",
                                },
                                `Pistas Disponibles`,
                              ),
                              m(
                                "p",
                                {
                                  class:
                                    "text-[10px] text-slate-400 font-bold uppercase",
                                },
                                `Viendo resultados para el ${State.selectedDate}`,
                              ),
                            ]),
                          ]),
                          m(
                            "span",
                            {
                              class:
                                "text-[10px] font-black text-green-500 bg-green-50 px-3 py-1.5 rounded-full",
                            },
                            `${State.selectedTime}H`,
                          ),
                        ],
                      ),
                      m(CourtGrid),
                    ])
                  : State.currentView === "matchmaking"
                    ? m(MatchmakingView)
                    : m(AgendaView),
              ],
            ),
            m(BookingModal),
            m(Footer),
            m(ConfirmModal),

            m(
              "div",
              {
                class: `fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-2xl text-xs font-bold shadow-2xl transition-all z-[200] ${State.toast.show ? "translate-y-0 opacity-100" : "translate-y-24 opacity-0"}`,
              },
              State.toast.message,
            ),

            State.isTerminatingSession &&
              m(
                "div",
                {
                  class:
                    "fixed inset-0 bg-white/80 backdrop-blur-md z-[250] flex flex-col items-center justify-center animate-fade-up",
                },
                [
                  m("div", {
                    class:
                      "w-12 h-12 border-4 border-slate-200 border-t-green-500 rounded-full animate-spin mb-4",
                  }),
                  m(
                    "p",
                    {
                      class:
                        "text-slate-800 font-black text-sm tracking-widest uppercase",
                    },
                    "Cerrando sesión...",
                  ),
                ],
              ),
          ]),
      };

      m.mount(document.getElementById("app"), {
        oninit: Actions.checkSession,
        view: () => m("div", [m(MainLayout)]),
      });

      // Cerrar el menú si se hace click fuera
      window.addEventListener("click", () => {
        if (State.showUserMenu) {
          State.showUserMenu = false;
          m.redraw();
        }
      });
    </script>
  </body>
</html>
