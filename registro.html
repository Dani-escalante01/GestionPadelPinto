<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta - Padel Pinto</title>
    <script src="https://components.digitalvalue.es/lib/mithril.min.js"></script>
    <script src="api.js"></script>
    <script src="toggleTheme.js"></script>
    <link rel="icon" type="image/svg+xml" href="src/favicon.svg" /> <!-- favicon -->
    <link rel="stylesheet" href="styles.css">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .dark .form-side {
            background-color: #020617;
        }

        .dark .register-card {
            background-color: #1e293b;
            border-color: #334155;
        }

        .dark .input-field {
            background-color: #0f172a;
            border-color: #334155;
            color: white;
        }

        .dark .input-field:focus {
            background-color: #0f172a; 
            border-color: var(--primary);
            color: white;
        }

        .dark .label {
            color: #cbd5e1;
        }

        /* --- 2. LAYOUT SPLIT --- */
        .split-layout {
            display: flex;
            flex: 1;
            min-height: 100vh;
            width: 100%;
        }

        /* Lado Izquierdo (Imagen Full) */
        .hero-side {
            display: none;
            flex: 1.2;
            position: relative;
            background-color: var(--dark-bg);
            overflow: hidden;
        }

        @media (min-width: 900px) {
            .hero-side {
                display: flex;
            }
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.6;
            mix-blend-mode: overlay;
            transform: scale(1.05);
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.9), transparent);
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            color: white;
            box-sizing: border-box;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 15px;
            line-height: 1;
            letter-spacing: -1px;
        }

        /* Lado Derecho (Formulario Scrollable) */
        .form-side {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Centrado vertical */
            background-color: var(--bg-dirty-white);
            position: relative;
            padding: 20px;
            overflow-y: auto;
            /* Permitir scroll si el formulario es alto */
            min-height: 100vh;
            /* Asegura que no se encoja */
        }

        /* --- NAVBAR FLOTANTE --- */
        .navbar-floating {
            position: absolute;
            top: 20px;
            right: 40px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .brand-mobile {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            font-size: 18px;
            color: var(--text-main);
        }

        @media (min-width: 900px) {
            .brand-mobile {
                display: none;
            }
        }

        /* --- TARJETA DE REGISTRO --- */
        .register-card {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 450px;
            /* Un poco más ancha que login */
            padding: 40px;
            border-radius: 32px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.6s ease-out;
            margin-top: 80px;
            /* Aumentado un poco para que no choque con la navbar en móviles */
            margin-bottom: 40px;
            /* Margen para que respire abajo al hacer scroll */
            box-sizing: border-box;
        }

        .form-header {
            margin-bottom: 25px;
            text-align: left;
        }

        h1 {
            font-size: 28px;
            font-weight: 800;
            margin: 0 0 10px 0;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .label {
            display: block;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 6px;
            color: var(--text-main);
            letter-spacing: 0.5px;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 2px solid var(--bg-dirty-white);
            background-color: #f8fafc;
            font-size: 14px;
            font-weight: 600;
            outline: none;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .input-field:focus {
            border-color: var(--primary);
            background-color: white;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1);
        }

        /* Estilo especial para Select */
        select.input-field {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%231e293b%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 0.65em auto;
            cursor: pointer;
        }

        .btn-primary {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 14px;
            font-weight: 800;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            margin-top: 10px;
            box-shadow: 0 10px 20px -5px rgba(34, 197, 94, 0.4);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: var(--border);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .error-msg {
            background: #fee2e2;
            color: #ef4444;
            padding: 12px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-footer {
            margin-top: 25px;
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .link {
            color: var(--primary);
            font-weight: 800;
            text-decoration: none;
            transition: color 0.2s;
        }

        .link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <div id="app"></div>

    <script>
        // --- ESTADO ---
        const State = {
            form: {
                nombre: "",
                email: "",
                password: "",
                nivel: ""
            },
            loading: false,
            error: null
        };

        // --- ACCIONES ---
        const Actions = {
            setInput: (field, value) => {
                State.form[field] = value;
                State.error = null;
            },

            register: async (e) => {
                e.preventDefault();
                State.loading = true;
                State.error = null;

                if (!State.form.nombre || !State.form.email || !State.form.password) {
                    State.error = "Todos los campos son obligatorios.";
                    State.loading = false;
                    return;
                }

                const res = await Auth.register(State.form);

                if (res.success) {
                    alert("¡Cuenta creada con éxito! Inicia sesión.");
                    window.location.href = "login.html";
                } else {
                    State.error = res.error || "Error al registrarse.";
                }

                State.loading = false;
                m.redraw();
            }
        };

        // --- COMPONENTES ---

        // 1. Panel Izquierdo (Imagen Diferente)
        function HeroSide() {
            return {
                view: () => m("div", { class: "hero-side" }, [
                    m("img", {
                        src: "https://images.unsplash.com/photo-1599423300746-b62533397364?q=80&w=2070",
                        class: "hero-bg"
                    }),
                    m("div", { class: "hero-overlay" }),
                    m("div", { class: "hero-content" }, [
                        m("div", {
                            style: "background: var(--primary); width: 50px; height: 50px; display:flex; align-items:center; justify-content:center; border-radius:12px; font-weight:900; font-size:24px; margin-bottom:20px; box-shadow: 0 10px 20px rgba(0,0,0,0.3);"
                        }, "P"),
                        m("h2", { class: "hero-title" }, "Sube de nivel."),
                        m("p", { style: "font-size: 1.2rem; opacity: 0.8; font-weight:500; max-width: 400px;" },
                            "Crea tu perfil en segundos y empieza a competir en la mejor liga local."
                        )
                    ])
                ])
            };
        }

        // 2. Formulario de Registro
        function RegisterCard() {
            return {
                view: () => m("div", { class: "register-card" }, [
                    m("form", { onsubmit: Actions.register }, [

                        m("div", { class: "form-header" }, [
                            m("h1", "Crear Cuenta"),
                            m("p", { class: "subtitle" }, "Completa tus datos para unirte al club.")
                        ]),

                        State.error ? m("div", { class: "error-msg animate-fade-up" }, [
                            m("span", "⚠️"), m("span", State.error)
                        ]) : null,

                        // Nombre
                        m("div", { class: "form-group" }, [
                            m("label", { class: "label" }, "Nombre Completo"),
                            m("input", {
                                type: "text",
                                class: "input-field",
                                placeholder: "Ej. Carlos Pérez",
                                value: State.form.nombre,
                                oninput: (e) => Actions.setInput("nombre", e.target.value)
                            })
                        ]),

                        // Email
                        m("div", { class: "form-group" }, [
                            m("label", { class: "label" }, "Correo Electrónico"),
                            m("input", {
                                type: "email",
                                class: "input-field",
                                placeholder: "tu@email.com",
                                value: State.form.email,
                                oninput: (e) => Actions.setInput("email", e.target.value)
                            })
                        ]),

                        // Password
                        m("div", { class: "form-group" }, [
                            m("label", { class: "label" }, "Contraseña"),
                            m("input", {
                                type: "password",
                                class: "input-field",
                                placeholder: "Mínimo 6 caracteres",
                                value: State.form.password,
                                oninput: (e) => Actions.setInput("password", e.target.value)
                            })
                        ]),

                        // Nivel
                        m("div", { class: "form-group" }, [
                            m("label", { class: "label" }, "Nivel Inicial"),
                            m("select", {
                                class: "input-field",
                                required: true,
                                value: State.form.nivel,
                                onchange: (e) => Actions.setInput("nivel", e.target.value)
                            }, [
                                m("option", { value: "1.0" }, "1.0 - Iniciación"),
                                m("option", { value: "2.0" }, "2.0 - Principiante"),
                                m("option", { value: "3.0" }, "3.0 - Intermedio"),
                                m("option", { value: "4.0" }, "4.0 - Avanzado"),
                                m("option", { value: "5.0" }, "5.0 - Profesional")
                            ])
                        ]),

                        m("button", {
                            type: "submit",
                            class: "btn-primary",
                            disabled: State.loading
                        }, State.loading ? "Creando perfil..." : "REGISTRARME GRATIS"),

                        m("div", { class: "form-footer" }, [
                            m("span", "¿Ya eres miembro? "),
                            m("a", { href: "login.html", class: "link" }, "Inicia sesión aquí")
                        ])
                    ])
                ])
            };
        }

        // --- LAYOUT ---
        function Layout() {
            return {
                view: () => m("div", { class: "split-layout" }, [
                    // Izquierda
                    m(HeroSide),

                    // Derecha
                    m("div", { class: "form-side" }, [
                        // Navbar flotante
                        m("div", { class: "navbar-floating" }, [
                            m("a", { href: "index.html", style: "text-decoration:none; color:var(--text-muted); font-size:12px; font-weight:700;" }, "VOLVER"),
                            m(ThemeToggle)
                        ]),
                        m("a", { href: "index.html", class: "brand-mobile" }, [
                            m("div", { style: "background:var(--primary); color:white; width:30px; height:30px; border-radius:6px; display:flex; align-items:center; justify-content:center; font-weight:bold;" }, "P"),
                            m("span", "PADELPINTO")
                        ]),

                        m(RegisterCard)
                    ])
                ])
            };
        }

        // --- INIT ---
        m.mount(document.getElementById("app"), Layout);

    </script>
</body>

</html>